{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Cycling Training Plan Report Data",
  "description": "Schema for consolidated training plan report data",
  "type": "object",
  "required": ["version", "generated_timestamp", "generator", "athletes"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Data format version",
      "pattern": "^\\d+\\.\\d+(\\.\\d+)?$"
    },
    "generated_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when this file was generated"
    },
    "generator": {
      "type": "object",
      "required": ["tool", "version"],
      "properties": {
        "tool": {
          "type": "string",
          "description": "Name of the tool that generated this file"
        },
        "version": {
          "type": "string",
          "description": "Version of the tool"
        },
        "command": {
          "type": "string",
          "description": "Command used to generate the file"
        }
      }
    },
    "athletes": {
      "type": "array",
      "description": "Array of athlete objects",
      "items": {
        "$ref": "#/definitions/athlete"
      }
    }
  },
  "definitions": {
    "athlete": {
      "type": "object",
      "required": ["id", "name", "profile", "training_plan", "metadata"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the athlete",
          "pattern": "^[a-z0-9_]+$"
        },
        "name": {
          "type": "string",
          "description": "Display name for the athlete"
        },
        "profile": {
          "$ref": "#/definitions/profile"
        },
        "training_plan": {
          "$ref": "#/definitions/training_plan"
        },
        "performance_analysis": {
          "$ref": "#/definitions/performance_analysis"
        },
        "metadata": {
          "$ref": "#/definitions/metadata"
        }
      }
    },
    "profile": {
      "type": "object",
      "required": ["age", "ftp", "weight_kg", "power_to_weight", "training_availability", "goals"],
      "properties": {
        "age": {
          "type": "integer",
          "minimum": 1,
          "maximum": 120
        },
        "gender": {
          "type": "string",
          "enum": ["male", "female", "other"]
        },
        "ftp": {
          "type": "number",
          "minimum": 0,
          "description": "Functional Threshold Power in watts"
        },
        "weight_kg": {
          "type": "number",
          "minimum": 0,
          "description": "Body weight in kilograms"
        },
        "power_to_weight": {
          "type": "number",
          "minimum": 0,
          "description": "Power to weight ratio (W/kg)"
        },
        "max_hr": {
          "type": "integer",
          "minimum": 0,
          "maximum": 300,
          "description": "Maximum heart rate in bpm"
        },
        "resting_hr": {
          "type": "integer",
          "minimum": 0,
          "maximum": 200,
          "description": "Resting heart rate in bpm"
        },
        "training_availability": {
          "type": "object",
          "required": ["hours_per_week", "available_training_days", "weekly_training_hours"],
          "properties": {
            "hours_per_week": {
              "type": "number",
              "minimum": 0
            },
            "week_days": {
              "type": "string"
            },
            "available_training_days": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
              }
            },
            "weekly_training_hours": {
              "type": "number",
              "minimum": 0
            }
          }
        },
        "goals": {
          "type": "string",
          "description": "Athlete's training goals"
        },
        "current_training_status": {
          "type": "string",
          "description": "Current training status description"
        }
      }
    },
    "training_plan": {
      "type": "object",
      "required": ["current_ftp", "target_ftp", "ftp_gain", "ftp_gain_percent", "total_weeks", "available_days_per_week", "power_zones", "weekly_workouts"],
      "properties": {
        "current_ftp": {
          "type": "number",
          "minimum": 0
        },
        "target_ftp": {
          "type": "number",
          "minimum": 0
        },
        "ftp_gain": {
          "type": "number"
        },
        "ftp_gain_percent": {
          "type": "number"
        },
        "total_weeks": {
          "type": "integer",
          "minimum": 1
        },
        "available_days_per_week": {
          "type": "integer",
          "minimum": 1,
          "maximum": 7
        },
        "plan_structure": {
          "type": "object",
          "properties": {
            "foundation_weeks": {
              "type": "integer",
              "minimum": 0
            },
            "build_weeks": {
              "type": "integer",
              "minimum": 0
            },
            "peak_weeks": {
              "type": "integer",
              "minimum": 0
            },
            "recovery_weeks": {
              "type": "array",
              "items": {
                "type": "integer",
                "minimum": 1
              }
            }
          }
        },
        "power_zones": {
          "$ref": "#/definitions/power_zones"
        },
        "plan_text": {
          "type": "string",
          "description": "Markdown-formatted plan summary"
        },
        "weekly_workouts": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/week"
          }
        }
      }
    },
    "power_zones": {
      "type": "object",
      "required": ["z1", "z2", "z3", "z4", "z5"],
      "properties": {
        "z1": {
          "$ref": "#/definitions/zone"
        },
        "z2": {
          "$ref": "#/definitions/zone"
        },
        "z3": {
          "$ref": "#/definitions/zone"
        },
        "z4": {
          "$ref": "#/definitions/zone"
        },
        "z5": {
          "$ref": "#/definitions/zone"
        },
        "sweet_spot": {
          "$ref": "#/definitions/zone"
        }
      }
    },
    "zone": {
      "type": "object",
      "required": ["name", "min", "max"],
      "properties": {
        "name": {
          "type": "string"
        },
        "min": {
          "type": "integer",
          "minimum": 0
        },
        "max": {
          "type": ["integer", "null"],
          "minimum": 0
        }
      }
    },
    "week": {
      "type": "object",
      "required": ["week", "phase", "workouts"],
      "properties": {
        "week": {
          "type": "integer",
          "minimum": 1
        },
        "phase": {
          "type": "string",
          "enum": ["Foundation", "Build", "Peak", "Recovery"]
        },
        "workouts": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/workout"
          }
        }
      }
    },
    "workout": {
      "type": "object",
      "required": ["weekday", "description", "total_duration_min", "segments"],
      "properties": {
        "weekday": {
          "type": "string",
          "enum": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
          "description": "Day of the week for this workout"
        },
        "description": {
          "type": "string"
        },
        "total_duration_min": {
          "type": "integer",
          "minimum": 0
        },
        "work_time_min": {
          "type": "integer",
          "minimum": 0
        },
        "intensity_zone": {
          "type": "string"
        },
        "segments": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/segment"
          }
        }
      }
    },
    "segment": {
      "type": "object",
      "required": ["duration_min", "power_low_pct", "power_high_pct", "description", "type"],
      "properties": {
        "duration_min": {
          "type": "integer",
          "minimum": 0
        },
        "power_low_pct": {
          "type": "number",
          "minimum": 0,
          "maximum": 200,
          "description": "Lower power bound as percentage of FTP (e.g., 85.0 for 85% FTP)"
        },
        "power_high_pct": {
          "type": "number",
          "minimum": 0,
          "maximum": 200,
          "description": "Upper power bound as percentage of FTP (e.g., 95.0 for 95% FTP)"
        },
        "description": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["warmup", "interval", "work", "recovery", "cooldown", "steady", "tempo"]
        }
      }
    },
    "performance_analysis": {
      "type": "object",
      "required": ["athlete_profile", "performance_comparison", "time_in_zones", "key_trends", "insights", "recommendations", "analysis_period_months"],
      "properties": {
        "athlete_profile": {
          "type": "object",
          "required": ["name", "current_ftp", "weight", "w_kg", "age", "experience_level"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Athlete name"
            },
            "current_ftp": {
              "type": "number",
              "minimum": 0,
              "description": "Current Functional Threshold Power in watts"
            },
            "weight": {
              "type": "number",
              "minimum": 0,
              "description": "Body weight in kilograms"
            },
            "w_kg": {
              "type": "number",
              "minimum": 0,
              "description": "Power to weight ratio (watts per kilogram)"
            },
            "age": {
              "type": "integer",
              "minimum": 1,
              "maximum": 120,
              "description": "Athlete age in years"
            },
            "experience_level": {
              "type": "string",
              "description": "Athlete experience level"
            }
          }
        },
        "performance_comparison": {
          "type": "array",
          "description": "Array of performance metric comparisons between periods",
          "items": {
            "type": "object",
            "required": ["metric", "previous", "current", "change", "trend"],
            "properties": {
              "metric": {
                "type": "string",
                "description": "Name of the performance metric"
              },
              "previous": {
                "type": "string",
                "description": "Value in previous period"
              },
              "current": {
                "type": "string",
                "description": "Value in current period"
              },
              "change": {
                "type": "string",
                "description": "Change between periods"
              },
              "trend": {
                "type": "string",
                "enum": ["up", "down", "neutral"],
                "description": "Direction of trend"
              }
            }
          }
        },
        "time_in_zones": {
          "type": "array",
          "description": "Time spent in each power zone",
          "items": {
            "type": "object",
            "required": ["zone", "name", "percentage", "hours"],
            "properties": {
              "zone": {
                "type": "integer",
                "minimum": 1,
                "maximum": 5,
                "description": "Zone number (1-5)"
              },
              "name": {
                "type": "string",
                "description": "Zone name"
              },
              "percentage": {
                "type": "number",
                "minimum": 0,
                "maximum": 100,
                "description": "Percentage of total time in this zone"
              },
              "hours": {
                "type": "number",
                "minimum": 0,
                "description": "Total hours in this zone"
              }
            }
          }
        },
        "key_trends": {
          "type": "array",
          "description": "Key trends identified in the analysis",
          "minItems": 3,
          "maxItems": 5,
          "items": {
            "type": "object",
            "required": ["title", "description"],
            "properties": {
              "title": {
                "type": "string",
                "description": "Short trend title"
              },
              "description": {
                "type": "string",
                "description": "Detailed description"
              }
            }
          }
        },
        "insights": {
          "type": "array",
          "description": "Actionable insights from analysis",
          "minItems": 3,
          "maxItems": 5,
          "items": {
            "type": "object",
            "required": ["title", "description"],
            "properties": {
              "title": {
                "type": "string",
                "description": "Short insight title"
              },
              "description": {
                "type": "string",
                "description": "Detailed explanation"
              }
            }
          }
        },
        "recommendations": {
          "type": "object",
          "required": ["short_term", "long_term", "recovery_nutrition"],
          "properties": {
            "short_term": {
              "type": "array",
              "description": "Short-term recommendations",
              "items": {
                "type": "object",
                "required": ["text"],
                "properties": {
                  "text": {
                    "type": "string"
                  }
                }
              }
            },
            "long_term": {
              "type": "array",
              "description": "Long-term recommendations",
              "items": {
                "type": "object",
                "required": ["text"],
                "properties": {
                  "text": {
                    "type": "string"
                  }
                }
              }
            },
            "recovery_nutrition": {
              "type": "array",
              "description": "Recovery and nutrition recommendations",
              "items": {
                "type": "object",
                "required": ["text"],
                "properties": {
                  "text": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "analysis_period_months": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of months analyzed"
        }
      }
    },
    "metadata": {
      "type": "object",
      "required": ["sources", "generated_at"],
      "properties": {
        "sources": {
          "type": "object",
          "required": ["interaction_log"],
          "properties": {
            "interaction_log": {
              "type": "string"
            },
            "interaction_id": {
              "type": "integer",
              "minimum": 0
            },
            "athlete_profile": {
              "type": "string"
            }
          }
        },
        "generated_at": {
          "type": "string",
          "format": "date-time"
        },
        "llm_provider": {
          "type": "string"
        },
        "llm_model": {
          "type": "string"
        },
        "generation_duration_ms": {
          "type": "number",
          "minimum": 0
        }
      }
    }
  }
}
